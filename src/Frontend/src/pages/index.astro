---
const SOAP_NS = 'urn:mini-facturacion:v1';
const SL_URL = 'http://localhost:8080/soap/mini';
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Mini-Facturación (Astro + SOAP)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body{font-family:system-ui,sans-serif;margin:2rem;max-width:900px}
      section{border:1px solid #ddd;padding:1rem;border-radius:12px;margin:1rem 0}
      .row{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
      input,button{padding:.5rem;border-radius:8px;border:1px solid #ccc}
      pre{background:#111;color:#eee;padding:1rem;border-radius:8px;overflow:auto}
    </style>
  </head>
  <body>
    <h1>Mini-Facturación</h1>
    <small>APP (Astro) → SOAP/XML → SL → SOAP/XML → SAD → SQL</small>

    <section>
      <h2>Monto en letras</h2>
      <div class="row">
        <div><label>Monto</label><input id="monto" type="number" step="0.01" value="12345.67" /></div>
        <div><label>Moneda</label><input id="moneda" value="COP" /></div>
        <div><label>Cultura</label><input id="cultura" value="es-CO" /></div>
      </div>
      <button id="btn1">Enviar (SOAP)</button>
      <pre id="resp1"></pre>
    </section>

    <section>
      <h2>Crear cliente</h2>
      <div class="row">
        <div><label>Nombres</label><input id="nombres" value="Juan Camilo" /></div>
        <div><label>Documento</label><input id="documento" value="123456789" /></div>
        <div><label>Email</label><input id="email" value="juan@example.com" /></div>
      </div>
      <button id="btn2">Crear (SOAP)</button>
      <pre id="resp2"></pre>
    </section>

    <script>
      const SOAP_NS = 'urn:mini-facturacion:v1';
      const SL_URL = 'http://localhost:8080/soap/mini';

      function postSoap(action, envelope) {
        return fetch(SL_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'text/xml; charset=utf-8',
            'SOAPAction': `"${SOAP_NS}/IMiniFacturacionService/${action}"`
          },
          body: envelope
        }).then(r => r.text());
      }

      function escapeXml(s){return s.replace(/[<>&'"]/g, c => ({'<':'&lt;','>':'&gt;','&':'&amp;',"'":'&apos;','"':'&quot;'}[c]));}

      document.getElementById('btn1').onclick = () => {
        const monto = document.getElementById('monto').value;
        const moneda = document.getElementById('moneda').value;
        const cultura = document.getElementById('cultura').value;

        const xml = `
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:v1="${SOAP_NS}">
  <soapenv:Body>
    <v1:MontoEnLetras>
      <v1:req>
        <v1:Monto>${monto}</v1:Monto>
        <v1:Moneda>${moneda}</v1:Moneda>
        <v1:Cultura>${cultura}</v1:Cultura>
      </v1:req>
    </v1:MontoEnLetras>
  </soapenv:Body>
</soapenv:Envelope>`.trim();

        postSoap('MontoEnLetras', xml).then(t => document.getElementById('resp1').textContent = t);
      };

      document.getElementById('btn2').onclick = () => {
        const nombres = document.getElementById('nombres').value;
        const documento = document.getElementById('documento').value;
        const email = document.getElementById('email').value;

        const xml = `
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:v1="${SOAP_NS}">
  <soapenv:Body>
    <v1:CrearCliente>
      <v1:nombres>${escapeXml(nombres)}</v1:nombres>
      <v1:documento>${escapeXml(documento)}</v1:documento>
      <v1:email>${escapeXml(email)}</v1:email>
    </v1:CrearCliente>
  </soapenv:Body>
</soapenv:Envelope>`.trim();

        postSoap('CrearCliente', xml).then(t => document.getElementById('resp2').textContent = t);
      };
    </script>
  </body>
</html>
